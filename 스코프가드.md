# 스코프 가드(Scope Guard)

스코프 가드는 “함수가 끝날 때(스코프 종료 시) 반드시 실행돼야 하는 정리 코드”를 소멸자에 넣어 자동 실행되게 하는 패턴이다.

## 왜 중요한가

엔드포인트/파일 스캔 코드는 실패 분기(return)와 예외 가능성이 많고 자원을 하나 사용하면마지막에는 반드시 해제·닫기·풀기 같은 정리를 해야하는데
사람이 매번 정리 코드를 직접 넣다 보면 어떤 분기에서는 빠뜨리기 쉽다.
스코프 가드는 정리코드를 객체의 소멸자에 맡겨 두는 방식이기때문에 함수가 어디서 끝나든 스코프를 벗어나는 순간 소멸자가 자동으로 실행되어 정리가 항상 보장된다

## 언제 쓰나(대표 상황)
- new 했으면 delete 해야 할 때
  함수 중간에 return하면 delete 줄을 못 만나서 누수가 날 수 있다.
- 파일/핸들을 열었으면 닫아야 할 때
  fopen() / CreateFile() / OpenProcess() 같은 걸로 열고, fclose() / CloseHandle()로 닫아야 한다.
  중간에 실패 처리로 빠져나가면 닫기 누락이 생기기 쉽다.
- 락을 걸었으면 반드시 풀어야 할 때
  mutex.lock() 후에 mutex.unlock()을 해야 하는데, 예외나 return으로 빠지면 unlock을 못 해서 멈출 수 있다.

## 핵심 정리
- 스코프 가드는 “생성자에서 등록, 소멸자에서 실행” 구조다.
- 스코프를 벗어나면 무조건 실행되므로 return/예외에 강하다.
- **복사되면 중복 실행 위험**이 있으니 보통 복사를 막는다.
## 예제:

#include <iostream>
using namespace std;

class ScopeGuard {
public:
    ScopeGuard() { cout << "가드 생성!\n"; }
    ~ScopeGuard() { cout << "정리 실행!\n"; }
};

void Work() {
    ScopeGuard g;
    cout << "작업 중...\n";
} 

int main() {
    Work();
}
